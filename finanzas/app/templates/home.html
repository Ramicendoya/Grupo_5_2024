{% extends 'base.html' %}
{% load static %}

{% block main %}
<div class="container my-4">
    <header class="text-center">
        <h1>Saldo Actual y Estimado</h1>
    </header>

    <!-- KPI Cards for Saldo Actual y Saldo Futuro -->
    <div class="row my-4">
        <div class="col-md-4 offset-md-2 text-center">
            <div class="card p-3">
                <h5>Saldo Actual</h5>
                <h3 id="saldo-actual">$0.00</h3>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="card p-3">
                <h5>Saldo Futuro</h5>
                <h3 id="saldo-futuro">$0.00</h3>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="row my-3 justify-content-center">
        <div class="col-md-4 text-center">
            <select class="form-select" id="filtro-tiempo" onchange="actualizarSaldoFuturo()">
                <option value="1" selected>Próximo mes</option>
                <option value="2">Próximos 2 meses</option>
                <option value="3">Próximos 3 meses</option>
            </select>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row">
        <div class="col-md-8">
            <div class="card p-3">
                <h5>Históricos de Saldos en los Últimos Meses</h5>
                <!-- Aquí puedes insertar el gráfico de barras de saldo -->
                <img src="{% static 'img/grafico_saldo.png' %}" class="img-fluid" alt="Histórico de Saldos">
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3">
                <h5>Porcentaje de Categorías</h5>
                <!-- Gráfico de porcentaje de categorías -->
                <img src="{% static 'img/grafico_pie.png' %}" class="img-fluid" alt="Porcentaje de Categorías">
                
                <h5>Porcentaje de Metas Cumplidas</h5>
                <h2>70%</h2>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchSaldoActual();
        fetchSaldoFuturo();
    });

    function fetchSaldoActual() {
        fetch('{% url "saldo_actual" %}')
            .then(response => response.json())
            .then(data => {
                const saldoActual = parseFloat(data.saldo_actual).toFixed(2);
                document.getElementById('saldo-actual').textContent = `$${saldoActual}`;
            })
            .catch(error => console.error('Error fetching saldo actual:', error));
    }

    function fetchSaldoFuturo() {
        fetch('{% url "saldo_futuro" %}')
            .then(response => response.json())
            .then(data => {
                actualizarSaldoFuturo(data);
            })
            .catch(error => console.error('Error fetching saldo futuro:', error));
    }

    function actualizarSaldoFuturo(data) {
        const filtro = document.getElementById('filtro-tiempo').value;
        let saldoFuturo;
        if (filtro === '1') {
            saldoFuturo = parseFloat(data.saldo_futuro_1_mes).toFixed(2);
        } else if (filtro === '2') {
            saldoFuturo = parseFloat(data.saldo_futuro_2_meses).toFixed(2);
        } else if (filtro === '3') {
            saldoFuturo = parseFloat(data.saldo_futuro_3_meses).toFixed(2);
        }
        document.getElementById('saldo-futuro').textContent = `$${saldoFuturo}`;
    }
</script>

{% endblock %}
